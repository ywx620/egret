var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);i.prototype=e.prototype,t.prototype=new i},AbstractP2Test=function(t){function e(){var e=t.call(this)||this;return e.factor=1,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/"),this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)},e.prototype.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.loadGroup("preload")},e.prototype.onResourceLoadComplete=function(t){"preload"==t.groupName&&(RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),this.onAppReady(),this.addEventListener(egret.Event.ENTER_FRAME,this.loop,this))},e.prototype.enableMouseDrag=function(t){this.world=t,this.emptyBody=new p2.Body,this.world.addBody(this.emptyBody),this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouch,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouch,this)},e.prototype.createDebug=function(){var t=new egret.Sprite;this.addChild(t),this.debugDraw=new p2DebugDraw(this.world,t)},e.prototype.createFourWall=function(){function t(t){var e=new p2.Box({width:t.width,height:t.height}),i=new p2.Body({mass:0});i.addShape(e),i.position=[t.x,t.y],a.addBody(i)}var e=100,i=this.stage.stageWidth,r=this.stage.stageHeight,o=i/2,n=r/2,a=this.world;t(new egret.Rectangle(o,0,i,e)),t(new egret.Rectangle(o,r,i,e)),t(new egret.Rectangle(0,n,e,r)),t(new egret.Rectangle(i,n,e,r))},e.prototype.onTouch=function(t){var e=new Array(t.stageX/this.factor,t.stageY/this.factor);switch(t.type){case egret.TouchEvent.TOUCH_BEGIN:var i=this.world.hitTest(e,this.world.bodies);if(i.length>0){var r=i[0];this.emptyBody.position[0]=e[0],this.emptyBody.position[1]=e[1],this.mouseJoint=new p2.RevoluteConstraint(this.emptyBody,r,{worldPivot:e,collideConnected:!1}),this.world.addConstraint(this.mouseJoint),this.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouch,this)}break;case egret.TouchEvent.TOUCH_END:this.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouch,this),this.world.removeConstraint(this.mouseJoint),this.mouseJoint=null;break;case egret.TouchEvent.TOUCH_MOVE:this.emptyBody.position[0]=e[0],this.emptyBody.position[1]=e[1]}},e.prototype.onAppReady=function(){},e.prototype.loop=function(){this.world.step(1/60),this.debugDraw.drawDebug()},e}(egret.DisplayObjectContainer);__reflect(AbstractP2Test.prototype,"AbstractP2Test");var BasicComponent=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.setSkinName=function(t){this.addEventListener(eui.UIEvent.COMPLETE,this.onComplete,this),this.skinName=t},e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.isCreateChildren=!0,this.init()},e.prototype.onComplete=function(){this.isLoadComplete=!0,this.init()},e.prototype.init=function(){this.isCreateChildren&&this.isLoadComplete&&this.render()},e.prototype.render=function(){},e.prototype.createBitmapByName=function(t,e){void 0===e&&(e=null);var i=new egret.Bitmap,r=RES.getRes(t);return i.texture=r,null!=e&&(i.scale9Grid=e),i},e.prototype.addKeyboardEvent=function(t,e){var i=this;document.addEventListener(t,function(r){e&&e({type:t,keyCode:r.keyCode,key:r.key,self:i})})},e}(eui.Component);__reflect(BasicComponent.prototype,"BasicComponent");var P2Camera=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.render,e),e}return __extends(e,t),e.prototype.render=function(){function t(t){s.move()}function e(t){var e=2,i=o.position[0],r=o.position[1],n=t.stageX-i,a=t.stageY-r,s=(Math.sqrt(n*n+a*a),n*e),h=a*e;o.applyImpulse([s,h],[0,0])}var i=new eui.Image("bg_jpg");i.width=1.2*this.stage.stageWidth,i.height=1.2*this.stage.stageHeight,this.addChild(i);var r=new P2World(0,200);r.createWall(new egret.Rectangle(0,0,this.width,this.height)),this.addChild(r);var o=r.createCircleBodyShape(50);o.mass=10;var n=new egret.Shape;n.graphics.lineStyle(1,16711680),n.graphics.beginFill(16776960),n.graphics.drawCircle(0,0,50),n.graphics.drawCircle(20,10,10),n.graphics.endFill(),this.addChild(n),o.userData.skin=n,r.drawSkin(r.createConvexBodyShape([[0,-150],[150,150],[-150,150]])),r.drawSkin(r.createConvexBodyShape([[-100,-100],[100,-100],[100,100],[-10,100]])),r.drawSkin(r.createConvexBodyShape([[-10,-10],[100,-10],[100,100],[-10,10]])),r.drawSkin(r.createBoxBodyShape(150,100)),r.drawSkin(r.createPolygon(8,50));var a=new egret.Rectangle(0,0,this.stage.stageWidth,this.stage.stageHeight),s=new control.Camera2D(o.userData.skin,this,a);this.addEventListener(egret.Event.ENTER_FRAME,t,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,e,this)},e}(BasicComponent);__reflect(P2Camera.prototype,"P2Camera");var P2Camera2=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.render,e),e}return __extends(e,t),e.prototype.render=function(){function t(t){i.x+i.width/2<2e3&&(i.x+=10),i.x+i.width/2<2e3&&(i.y+=10),o.move()}var e=new eui.Image("bg_jpg");e.width=e.height=2e3,this.addChild(e);var i=new egret.Shape;i.graphics.beginFill(16711680),i.graphics.drawCircle(0,0,100),i.graphics.endFill(),this.addChild(i);var r=new egret.Rectangle(0,0,this.stage.stageWidth,this.stage.stageHeight),o=new control.Camera2D(i,this,r);this.addEventListener(egret.Event.ENTER_FRAME,t,this)},e}(BasicComponent);__reflect(P2Camera2.prototype,"P2Camera2");var MainTest=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.init,e),e}return __extends(e,t),e.prototype.init=function(){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.init,this),this.stageW=this.stage.stageWidth,this.stageH=this.stage.stageHeight,this.dragon()},e.prototype.dragon=function(){this.addChild(new GameParkour)},e.prototype.p2Test=function(){this.addChild(new P2Camera)},e.prototype.readJson=function(){new ReadJson},e.prototype.astar=function(){this.addChild(new AStarTest)},e.prototype.moon=function(){var t=new egret.Rectangle(0,0,this.stageW,this.stageH),e=new egret.Rectangle(10,200,20,200),i=new moon.MapHorizontalHouse(t,e,0);this.addChild(i);var t=new egret.Rectangle(0,0,this.stageW,this.stageH),e=new egret.Rectangle(10,100,40,100),i=new moon.MapHorizontalHouse(t,e);this.addChild(i)},e}(egret.DisplayObjectContainer);__reflect(MainTest.prototype,"MainTest");var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,i,r){function o(t){e.call(r,t)}function n(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,n,null),i.call(r))}"undefined"!=typeof generateEUI&&egret.callLater(function(){e.call(r,generateEUI)},this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,n,null),RES.getResByUrl(t,o,this,RES.ResourceItem.TYPE_TEXT)},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var DragonDemoAction;!function(t){var e;!function(t){t[t.stand=0]="stand",t[t.walk=1]="walk",t[t.run=2]="run",t[t.atk=3]="atk",t[t.hurt=4]="hurt",t[t.jump=5]="jump",t[t.jumpTwo=6]="jumpTwo",t[t.jumpDown=7]="jumpDown"}(e=t.names||(t.names={}))}(DragonDemoAction||(DragonDemoAction={}));var DragonDemo=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.addToStage,e),e}return __extends(e,t),e.prototype.addToStage=function(){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.addToStage,this),FrameAnimation.getIns().loop(),FrameAnimation.getIns().addFactoryByName("wukong"),this.names=[DragonDemoAction.names[0],DragonDemoAction.names[1],DragonDemoAction.names[2],DragonDemoAction.names[3],DragonDemoAction.names[4],DragonDemoAction.names[5],DragonDemoAction.names[6],DragonDemoAction.names[7]],this.role=FrameAnimation.getIns().getAnimationSpriteByName(this.names[DragonDemoAction.names.run]),this.role.x=200,this.role.y=200,this.addChild(this.role),this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onClick,this)},e.prototype.onClick=function(t){this.role=FrameAnimation.getIns().getAnimationSpriteByName(this.names[DragonDemoAction.names.jump])},e}(egret.DisplayObjectContainer);__reflect(DragonDemo.prototype,"DragonDemo");var FrameAnimation=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.data={},e}return __extends(e,t),e.getIns=function(){return null==this.instance&&(this.instance=new e),this.instance},e.prototype.loop=function(){function t(t){var e=.008;return dragonBones.WorldClock.clock.advanceTime(e),!1}egret.startTick(t,this)},e.prototype.setFactoryNameName=function(t){this.factoryName=t},e.prototype.addFactoryByName=function(t){this.factoryName=t;var e=RES.getRes(t+"_ske_json"),i=RES.getRes(t+"_tex_json"),r=RES.getRes(t+"_tex_png"),o=new dragonBones.EgretFactory;o.parseDragonBonesData(e),o.parseTextureAtlasData(r,i);o.addDragonBonesData(dragonBones.DataParser.parseDragonBonesData(e)),o.addTextureAtlasData(new dragonBones.EgretTextureAtlas(r,i)),this.data[t]=o},e.prototype.addWorld=function(t){dragonBones.WorldClock.clock.add(t)},e.prototype.getArmatureByName=function(t){var e=this.data[this.factoryName],i=e.buildArmature(t);return i},e.prototype.getDisplayByName=function(t){return this.getArmatureByName(t).getDisplay()},e.prototype.getAnimationByName=function(t){return this.getArmatureByName(t).animation},e.prototype.getAnimationSpriteByName=function(t){var e;null==this.data[this.factoryName+"-sprite"]&&(e=new egret.Sprite,this.data[this.factoryName+"-sprite"]=e),e=this.data[this.factoryName+"-sprite"],e.removeChildren();var i=this.getArmatureByName(t);return this.addWorld(i),e.addChild(i.display),i.animation.gotoAndPlay(t),e},e}(egret.HashObject);__reflect(FrameAnimation.prototype,"FrameAnimation");var AStar=function(){function t(){this.isEnd=!1,this._heuristic=this.diagonal,this._straightCost=1,this._diagCost=Math.SQRT2}return t.prototype.findPath=function(t){return this._grid=t,this._open=[],this._closed=[],this._startNode=this._grid.startNode,this._endNode=this._grid.endNode,this._startNode.g=0,this._startNode.h=this._heuristic(this._startNode),this._startNode.f=this._startNode.g+this._startNode.h,this._open[0]=this._startNode,this.search()},t.prototype.search=function(){for(var t;!this.isEnd;){var e,i=this._open.length;for(t=this._open[0],e=0,s=0;i>s;s++)this._open[s].f<t.f&&(t=this._open[s],e=s);this._open[e]=this._open[this._open.length-1],this._open.pop(),this._closed.push(t);for(var r=0>t.x-1?0:t.x-1,o=this._grid.numCols-1<t.x+1?this._grid.numCols-1:t.x+1,n=0>t.y-1?0:t.y-1,a=this._grid.numRows-1<t.y+1?this._grid.numRows-1:t.y+1,s=r;o>=s;s++)for(var h=n;a>=h;h++){var d=this._grid.getNode(s,h);if(d!=t&&d.walkable&&this._grid.getNode(t.x,d.y).walkable&&this._grid.getNode(d.x,t.y).walkable){var c=this._straightCost;t.x!=d.x&&t.y!=d.y&&(c=1.4);var l=t.g+c*d.costMultiplier,p=this._heuristic(d),g=l+p;-1!=this._open.indexOf(d)||-1!=this._closed.indexOf(d)?g<d.f&&(d.f=g,d.g=l,d.h=p,d.parent=t):(d.f=g,d.g=l,d.h=p,d.parent=t,this._open.push(d)),d==this._endNode&&(this.isEnd=!0)}}if(0==this._open.length)return console.log("no path found"),this.isEnd=!0,!1}return this.buildPath(),!0},t.prototype.floyd=function(){if(null!=this.path){this._floydPath=this.path.concat();var t=this._floydPath.length;if(t>2){var e=new NodePoint(0,0),i=new NodePoint(0,0);this.floydVector(e,this._floydPath[t-1],this._floydPath[t-2]);for(var r=this._floydPath.length-3;r>=0;r--)this.floydVector(i,this._floydPath[r+1],this._floydPath[r]),e.x==i.x&&e.y==i.y?this._floydPath.splice(r+1,1):(e.x=i.x,e.y=i.y)}for(t=this._floydPath.length,r=t-1;r>=0;r--)for(var o=0;r-2>=o;o++)if(0==this._grid.hasBarrier(this._floydPath[r].x,this._floydPath[r].y,this._floydPath[o].x,this._floydPath[o].y)){for(var n=r-1;n>o;n--)this._floydPath.splice(n,1);r=o,t=this._floydPath.length;break}}},t.prototype.floydVector=function(t,e,i){t.x=e.x-i.x,t.y=e.y-i.y},t.prototype.buildPath=function(){this._path=new Array;var t=this._endNode;for(this._path.push(t);t!=this._startNode;)t=t.parent,this._path.unshift(t)},Object.defineProperty(t.prototype,"path",{get:function(){return this._path},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"floydPath",{get:function(){return this._floydPath},enumerable:!0,configurable:!0}),t.prototype.manhattan=function(t){return Math.abs(t.x-this._endNode.x)*this._straightCost+Math.abs(t.y+this._endNode.y)*this._straightCost},t.prototype.euclidian=function(t){var e=t.x-this._endNode.x,i=t.y-this._endNode.y;return Math.sqrt(e*e+i*i)*this._straightCost},t.prototype.diagonal=function(t){var e=t.x-this._endNode.x<0?this._endNode.x-t.x:t.x-this._endNode.x,i=t.y-this._endNode.y<0?this._endNode.y-t.y:t.y-this._endNode.y,r=i>e?e:i,o=e+i;return 1.4*r+this._straightCost*(o-2*r)},Object.defineProperty(t.prototype,"visited",{get:function(){return this._open},enumerable:!0,configurable:!0}),t}();__reflect(AStar.prototype,"AStar");var NodePoint=function(){function t(t,e){this.walkable=!0,this.alphable=!1,this.costMultiplier=1,this.buriedDepth=-1,this.x=t,this.y=e}return t.prototype.getDistanceTo=function(t){var e=t.x-this.x,i=t.y-this.y;return this.distance=Math.sqrt(e*e+i*i),this.distance},t}();__reflect(NodePoint.prototype,"NodePoint");var Grid=function(){function t(t,e,i){this._numCols=t,this._numRows=e,this._cellSize=i,this._nodes=new Array;for(var r=0;r<this._numCols;r++){this._nodes[r]=[];for(var o=0;o<this._numRows;o++)this._nodes[r][o]=new NodePoint(r,o)}}return t.prototype.getNode=function(t,e){return this._nodes[t][e]},t.prototype.setEndNode=function(t,e){this._endNode=this._nodes[t][e]},t.prototype.setStartNode=function(t,e){this._startNode=this._nodes[t][e]},t.prototype.setWalkable=function(t,e,i){this._nodes[t][e].walkable=i},t.prototype.setAlphable=function(t,e,i){this._nodes[t][e].alphable=i},Object.defineProperty(t.prototype,"startNode",{get:function(){return this._startNode},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"endNode",{get:function(){return this._endNode},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"numCols",{get:function(){return this._numCols},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"numRows",{get:function(){return this._numRows},enumerable:!0,configurable:!0}),t.prototype.hasBarrier=function(t,e,i,r){if(t==i&&e==r)return!1;var o,n,a,s,h,d=new egret.Point(t*this._cellSize+this._cellSize/2,e*this._cellSize+this._cellSize/2),c=new egret.Point(i*this._cellSize+this._cellSize/2,r*this._cellSize+this._cellSize/2),l=Math.abs(i-t),p=Math.abs(r-e),g=l>p?!0:!1;if(g)for(o=MathUtil.getLineFunc(d,c,0),a=Math.min(t,i),s=Math.max(t,i),n=a;s>n;n++){var u=n*this._cellSize+this._cellSize,v=o(u);h=this.getNodesUnderPoint(n+1,v/this._cellSize);for(var y in h)if(0==h[y].walkable)return!0}else for(o=MathUtil.getLineFunc(d,c,1),a=Math.min(e,r),s=Math.max(e,r),n=a;s>n;n++){var f=n*this._cellSize+this._cellSize,m=o(f);h=this.getNodesUnderPoint(m/this._cellSize,n+1);for(var y in h)if(0==h[y].walkable)return!0}return!1},t.prototype.getNodesUnderPoint=function(t,e,i){void 0===i&&(i=null);var r=[],o=t%1==0,n=e%1==0;if(o&&n?(r[0]=this.getNode(t-1,e-1),r[1]=this.getNode(t,e-1),r[2]=this.getNode(t-1,e),r[3]=this.getNode(t,e)):o&&!n?(r[0]=this.getNode(t-1,Math.floor(e)),r[1]=this.getNode(t,Math.floor(e))):!o&&n?(r[0]=this.getNode(Math.floor(t),e-1),r[1]=this.getNode(Math.floor(t),e)):r[0]=this.getNode(Math.floor(t),Math.floor(e)),i&&i.length>0)for(var a=0;a<r.length;a++)-1!=i.indexOf(r[a])&&(r.splice(a,1),a--);return r},t.prototype.findReplacer=function(t,e){var i;if(e.walkable)i=e;else{-1==e.buriedDepth&&(e.buriedDepth=this.getNodeBuriedDepth(e,Math.max(this._numCols,this._numRows)));for(var r,o=e.x-e.buriedDepth<0?0:e.x-e.buriedDepth,n=e.x+e.buriedDepth>this.numCols-1?this.numCols-1:e.x+e.buriedDepth,a=e.y-e.buriedDepth<0?0:e.y-e.buriedDepth,s=e.y+e.buriedDepth>this.numRows-1?this.numRows-1:e.y+e.buriedDepth,h=o;n>=h;h++)for(var d=a;s>=d;d++)h>o&&n>h&&d>a&&s>d||(r=this.getNode(h,d),r.walkable&&(r.getDistanceTo(t),i?r.distance<i.distance&&(i=r):i=r))}return i},t.prototype.calculateBuriedDepth=function(){for(var t,e=0;e<this._numCols;e++)for(var i=0;i<this._numRows;i++)t=this._nodes[e][i],t.walkable?t.buriedDepth=0:t.buriedDepth=this.getNodeBuriedDepth(t,Math.max(this._numCols,this._numRows))},t.prototype.getNodeBuriedDepth=function(t,e){void 0===e&&(e=10);for(var i=t.walkable?0:1,r=1;e>=r;){for(var o,n=t.x-r<0?0:t.x-r,a=t.x+r>this.numCols-1?this.numCols-1:t.x+r,s=t.y-r<0?0:t.y-r,h=t.y+r>this.numRows-1?this.numRows-1:t.y+r,d=n;a>=d;d++)for(var c=s;h>=c;c++)if(o=this.getNode(d,c),o!=t&&o.walkable)return i;i++,r++}return i},t}();__reflect(Grid.prototype,"Grid");var MathUtil=function(){function t(){}return t.getLineFunc=function(t,e,i){void 0===i&&(i=0);var r;if(t.x==e.x){if(0==i)throw new Error("两点所确定直线垂直于y轴，不能根据x值得到y值");return 1==i&&(r=function(e){return t.x}),r}if(t.y==e.y){if(0==i)r=function(e){return t.y};else if(1==i)throw new Error("两点所确定直线垂直于y轴，不能根据x值得到y值");return r}var o;o=(t.y-e.y)/(t.x-e.x);var n;return n=t.y-o*t.x,0==i?r=function(t){return o*t+n}:1==i&&(r=function(t){return(t-n)/o}),r},t}();__reflect(MathUtil.prototype,"MathUtil");var AStarTest=function(t){function e(){var i=t.call(this)||this;return i._cellSize=40,e.instance=i,i.makeGrid(),i.makePlayer(),i}return __extends(e,t),e.prototype.makePlayer=function(){this._player=new egret.Sprite,this._player.touchEnabled=!0,this._player.graphics.beginFill(16711680),this._player.graphics.drawCircle(0,0,5),this._player.graphics.endFill(),this._player.x=50,this._player.y=60,this.addChild(this._player),this._lineShape=new egret.Shape,this.addChild(this._lineShape)},e.prototype.makeGrid=function(){this._gridContent=new egret.DisplayObjectContainer,this._gridContent.touchEnabled=!0,this._gridContent.touchChildren=!1,this._gridContent.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onGridClick,this),this.addChild(this._gridContent),this._grid=new Grid(10,10,40);for(var t=0;20>t;t++)this._grid.setWalkable(Math.floor(10*Math.random()),Math.floor(10*Math.random()),!1);this.drawGrid()},e.prototype.drawGrid=function(){this._gridArr=new Array;for(var t=0;t<this._grid.numCols;t++){this._gridArr[t]=[];for(var e=0;e<this._grid.numRows;e++){var i=this._grid.getNode(t,e),r=new egret.Shape;r.graphics.lineStyle(.1),r.graphics.beginFill(this.getColor(i)),r.graphics.drawRect(0,0,this._cellSize,this._cellSize),r.graphics.endFill(),r.x=t*this._cellSize,r.y=e*this._cellSize,this._gridContent.addChild(r),this._gridArr[t][e]=r}}},e.prototype.getColor=function(t){return t.walkable?t==this._grid.startNode?10066176:t==this._grid.endNode?255:13421772:0},e.prototype.onGridClick=function(t){var e=Math.floor(t.stageX/this._cellSize),i=Math.floor(t.stageY/this._cellSize),r=this._grid.getNode(e,i),o=Math.floor(this._player.x/this._cellSize),n=Math.floor(this._player.y/this._cellSize),a=this._grid.getNode(o,n);if(0==r.walkable){var s=this._grid.findReplacer(a,r);s&&(e=s.x,i=s.y)}this._grid.setStartNode(o,n),this._grid.setEndNode(e,i),this.findPath()},e.prototype.findPath=function(){var t=(egret.getTimer(),new AStar);t.findPath(this._grid)&&(t.floyd(),t.floydPath.shift(),this._path=t.floydPath,this._index=0,this.addEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this))},e.prototype.onEnterFrame=function(t){if(0==this._path.length)return void this.removeEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this);var e=this._path[this._index].x*this._cellSize+this._cellSize/2,i=this._path[this._index].y*this._cellSize+this._cellSize/2,r=e-this._player.x,o=i-this._player.y,n=Math.sqrt(r*r+o*o);1>n?(this._index++,this._index>=this._path.length&&this.removeEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this)):(this._player.x+=.5*r,this._player.y+=.5*o)},e}(egret.DisplayObjectContainer);__reflect(AStarTest.prototype,"AStarTest");var GameParkourAction;!function(t){var e;!function(t){t[t.stand=0]="stand",t[t.walk=1]="walk",t[t.run=2]="run",t[t.atk=3]="atk",t[t.hurt=4]="hurt",t[t.jump=5]="jump",t[t.jumpTwo=6]="jumpTwo",t[t.jumpDown=7]="jumpDown"}(e=t.names||(t.names={}))}(GameParkourAction||(GameParkourAction={}));var GameParkour=function(t){function e(){var e=t.call(this)||this;return e.roleMaterial=new p2.Material,e.stoneMaterial=new p2.Material,e.speed=100,e.stones=[],e.jumpNum=2,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.addToStage,e),e}return __extends(e,t),e.prototype.addToStage=function(){moon.showLog.getIns().init(this.stage),this.addChild(moon.MoonUI.getRect(this.stage.stageWidth,this.stage.stageHeight,16777215)),this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.addToStage,this),FrameAnimation.getIns().loop(),FrameAnimation.getIns().addFactoryByName("wukong"),this.names=[GameParkourAction.names[0],GameParkourAction.names[1],GameParkourAction.names[2],GameParkourAction.names[3],GameParkourAction.names[4],GameParkourAction.names[5],GameParkourAction.names[6],GameParkourAction.names[7]],this.createAction(GameParkourAction.names.jumpDown),this.createP2World(),this.gameInit()},e.prototype.gameInit=function(){if(null==this.btnStart){var t=new eui.Button;t.label="开始",t.x=this.stage.stageWidth-t.width>>1,t.y=this.stage.stageHeight-t.height>>1,t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.gameStart,this),this.btnStart=t}this.speed=100,this.jumpNum=0,this.addChild(this.btnStart),this.initStone()},e.prototype.gameStart=function(){this.removeChild(this.btnStart),this.isPlay=!0,this.createAction(GameParkourAction.names.run),this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onClick,this),this.addEventListener(egret.Event.ENTER_FRAME,this.onLoop,this)},e.prototype.gameOver=function(){this.isPlay=!1,this.stage.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onClick,this),this.removeEventListener(egret.Event.ENTER_FRAME,this.onLoop,this),moon.showLog.getIns().log("gameOver"),this.gameInit()},e.prototype.initStone=function(){for(var t=0;t<this.stones.length;t++){var e=this.stones[t];if(e.userData&&e.userData.skin){var i=e.userData.skin;i&&null!=i.parent&&i.parent.removeChild(i)}e.velocity=[0,0],this.p2World.removeBodys.push(e)}this.stones.length=0,this.createAction(GameParkourAction.names.run),this.roleBody.position=[100,330],this.roleBody.velocity=[0,0];var r=400,o=300;this.stones.push(this.createStone(r,o,0));for(var n=r,t=0;100>t;t++){var r=200*Math.random()+200,o=150*Math.random()+150;this.stones.push(this.createStone(r,o,n)),n+=1.2*r+100*Math.random()+100}},e.prototype.createP2World=function(){var t=new eui.Image("zm5Bg_png");t.width=this.stage.stageWidth,t.height=this.stage.stageHeight,this.addChild(t);var e=new P2World(0,200);e.world.on("beginContact",this.beginContact.bind(this)),e.createWall(new egret.Rectangle(0,0,this.width,this.height)),this.addChild(e);var i=e.createBoxCircleBodyShape(100,100);i.mass=20,i.userData.skin=this.roleDisplay,i.userData.name="role",i.shapes[0].material=this.roleMaterial,this.addChild(this.roleDisplay),this.p2World=e,this.roleBody=i,this.createStone(20,this.stage.stageHeight,this.stage.stageWidth>>1,"middle")},e.prototype.createAction=function(t){this.roleDisplay=FrameAnimation.getIns().getAnimationSpriteByName(this.names[t]),this.addChild(this.roleDisplay)},e.prototype.createStone=function(t,e,i,r){void 0===r&&(r=null);var o=this.stage.stageHeight,n=new eui.Image("zm5Ft_png");n.scale9Grid=new egret.Rectangle(70,35,2,2),n.height=e,n.width=t,this.addChild(n),n.anchorOffsetX=n.width>>1,n.anchorOffsetY=(n.height>>1)+15,"middle"==r&&(n.visible=!1);var a=this.p2World.createBoxBodyShape(n.width,n.height,p2.Body.KINEMATIC);a.userData.skin=n,a.userData.name=r||"stone";var s=o-(n.height>>1);a.position=[i,s],a.shapes[0].material=this.stoneMaterial;var h=new p2.ContactMaterial(this.roleMaterial,this.stoneMaterial,{restitution:0,friction:0});return this.p2World.world.addContactMaterial(h),a},e.prototype.onClick=function(t){if(this.createAction(GameParkourAction.names.jump),this.jumpNum<2){this.jumpNum++,this.roleBody.velocity[1]=0;var e=-3e3;this.roleBody.applyImpulse([0,e],[0,0]),2==this.jumpNum&&this.createAction(GameParkourAction.names.jumpTwo)}},e.prototype.beginContact=function(t){var e=t.bodyA.userData.name,i=t.bodyB.userData.name,r=t.bodyA.position[1],o=t.bodyB.position[1],n=t.bodyA.shapes[0].height,a=t.bodyB.shapes[0].height;if("stone"==e||"stone"==i){var s=!1;"stone"==e?r>o+a?s=!0:this.gameOver():"stone"==i&&(o>r+n?s=!0:this.gameOver()),s&&(this.jumpNum=0,this.isPlay?this.createAction(GameParkourAction.names.run):this.createAction(GameParkourAction.names.stand))}},e.prototype.onLoop=function(){var t=this.roleBody.velocity[1],e=this.roleBody.position[1];t>100&&this.createAction(GameParkourAction.names.jumpDown),e>this.stage.stageHeight&&this.gameOver();var i=this.p2World.world.bodies,r=i.length;moon.showLog.getIns().log("l="+r);for(var o=0;r>o;o++){var n=i[o];if(n.userData&&"stone"==n.userData.name){var a=n.userData.skin.width;n.velocity[0]=-this.speed,this.roleBody.velocity[0]=1.2*this.speed,n.position[0]<-a&&(this.p2World.removeBodys.push(n),this.speed+=10)}}},e}(egret.DisplayObjectContainer);__reflect(GameParkour.prototype,"GameParkour");var moon;!function(t){var e=function(){function t(){}return Object.defineProperty(t,"randomColor",{get:function(){return 16777215*Math.random()},enumerable:!0,configurable:!0}),t.getRect=function(t,e,i,r,o){void 0===i&&(i=0),void 0===r&&(r=0),void 0===o&&(o=0);var n=new egret.Sprite;return n.graphics.beginFill(i),n.graphics.drawRect(r,o,t,e),n.graphics.endFill(),n},t.getRectAndX=function(t,e,i,r,o){void 0===i&&(i=0),void 0===r&&(r=0),void 0===o&&(o=0);var n=this.getRect(t,e,i,r,o),a=new egret.Sprite;a.graphics.lineStyle(.1),a.graphics.moveTo(0,0),a.graphics.lineTo(t,e);var s=new egret.Sprite;return s.graphics.lineStyle(.1),s.graphics.moveTo(t,0),s.graphics.lineTo(0,e),n.addChild(a),n.addChild(s),n},t.getRoundRect=function(t,e,i,r,o,n,a){void 0===i&&(i=0),void 0===r&&(r=5),void 0===o&&(o=5),void 0===n&&(n=0),void 0===a&&(a=0);var s=new egret.Sprite;return s.graphics.beginFill(i),s.graphics.drawRoundRect(n,a,t,e,r,o),s.graphics.endFill(),s},t.getCircle=function(t,e,i,r){void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0);var o=new egret.Sprite;return o.graphics.beginFill(e),o.graphics.drawCircle(i,r,t),o.graphics.endFill(),o},t.getPolygon=function(t,e,i,r){void 0===t&&(t=3),void 0===e&&(e=10),void 0===i&&(i=0),void 0===r&&(r=0);var o=new egret.Sprite;o.rotation=r,o.graphics.beginFill(i);for(var n=0;t>=n;n++){var a=Math.cos(n*(360/t)*Math.PI/180)*e,s=Math.sin(n*(360/t)*Math.PI/180)*e;0==n?o.graphics.moveTo(a,s):o.graphics.lineTo(a,s)}return o.graphics.endFill(),o},t.getArrowRoundRect=function(t,e,i,r,o){void 0===r&&(r=0),void 0===o&&(o=0);var n=new egret.Sprite;n.addChild(this.getRoundRect(t,e,i));var a=this.getPolygon(3,t/3,r,30+o);return a.x=n.width>>1,a.y=n.height>>1,n.addChild(a),n},t.getScrollLineBar=function(t,e,i){for(var r=new egret.Sprite,o=e/3,n=0;3>n;n++){var a=this.getRect(t,1,i,0,n*o);r.addChild(a)}return r},t.getAddRoundRect=function(t,e,i){var r=new egret.Sprite;r.addChild(this.getRoundRect(t,e,i));var o=this.getRect(t/2,2,0,t/4,e/2-1),n=this.getRect(2,e/2,0,t/2-1,e/4);return r.addChild(o),r.addChild(n),r},t.getRemoveRoundRect=function(t,e,i){var r=new egret.Sprite;r.addChild(this.getRoundRect(t,e,i));var o=this.getRect(t/2,2,0,t/4,e/2-1);return r.addChild(o),r},t.getRoundRectText=function(t,e,i,r){void 0===r&&(r="click");var o=new egret.Sprite;o.addChild(this.getRoundRect(t,e,i));var n=new egret.TextField;return n.text=r,n.x=o.width-n.width>>1,n.y=o.height-n.height>>1,o.addChild(n),o},t.getCheckBoxRect=function(t,e,i){void 0===t&&(t=16777215),void 0===e&&(e=0),void 0===i&&(i=0);var r=new egret.Sprite;if(r.addChild(this.getRect(20,20,t)),1==i){var o=new egret.Sprite;o.graphics.beginFill(e),o.graphics.moveTo(0,10),o.graphics.lineTo(10,18),o.graphics.lineTo(22,4),o.graphics.lineTo(18,0),o.graphics.lineTo(10,9),o.graphics.lineTo(6,4),o.graphics.lineTo(0,10),r.addChild(o)}return r},t.getRadioCircle=function(t,e,i){void 0===t&&(t=16777215),void 0===e&&(e=0),void 0===i&&(i=0);var r=new egret.Sprite;if(r.addChild(this.getCircle(9,t,9,9)),1==i){var o=this.getCircle(5,e,9,9);r.addChild(o)}return r},t.getGridding=function(t,e){void 0===e&&(e=0);var i=new egret.Sprite;i.graphics.lineStyle(.1,e);for(var r=t.width/t.x,o=t.height/t.y,n=0;n<t.x;n++)i.graphics.moveTo(0,n*o),i.graphics.lineTo(t.width,n*o);for(n=0;n<t.y;n++)i.graphics.moveTo(n*r,0),i.graphics.lineTo(n*r,t.height);return i},t}();t.MoonUI=e,__reflect(e.prototype,"moon.MoonUI");var i=function(){function t(){}return t.getIns=function(){return null==this.instance&&(this.instance=new t),this.instance},t.prototype.init=function(t){var e=new egret.TextField;e.textAlign=egret.HorizontalAlign.LEFT,t.addChild(e),this.txtSimple=e;var e=new egret.TextField;t.addChild(e),this.txtMessage=e},t.prototype.log=function(t){this.txtSimple.text=t},t.prototype.logMessage=function(t){this.txtMessage.appendText(t+"\n")},t}();t.showLog=i,__reflect(i.prototype,"moon.showLog");var r=function(t){function e(){var e=t.call(this)||this;return e.init(),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.addToStage,e),e}return __extends(e,t),e.prototype.addToStage=function(){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.addToStage,this),this.render()},e.prototype.init=function(){},e.prototype.render=function(){},e}(egret.DisplayObjectContainer);t.MoonContainer=r,__reflect(r.prototype,"moon.MoonContainer");var o=function(e){function i(t,i,r){void 0===r&&(r=-1);var o=e.call(this)||this;return o.rect=t,o.house=i,o.color=r,o}return __extends(i,e),i.prototype.render=function(){var e=this.house,i=t.MoonUI.getRect(this.rect.width,this.rect.height);i.alpha=.1,this.addChild(i);for(var r=this.rect.width/e.width,o=0,n=0;r>n;n++){var a=-1==this.color?16777215*Math.random():this.color,s=e.width+Math.random()*e.x,h=e.height+Math.random()*e.y,d=t.MoonUI.getRect(s,h,a);this.addChild(d),d.y=this.rect.height-d.height,d.x=o,o=d.x+d.width}},i}(r);t.MapHorizontalHouse=o,__reflect(o.prototype,"moon.MapHorizontalHouse")}(moon||(moon={}));var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,i){function r(r){e.call(i,r,t)}if(RES.hasRes(t)){var o=RES.getRes(t);o?r(o):RES.getResAsync(t,r,this)}else RES.getResByUrl(t,r,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.addToStage,e),e}return __extends(e,t),e.prototype.addToStage=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.width=480,this.textField.height=50,this.textField.textAlign="center",this.textField.x=this.stage.stageWidth-this.textField.width>>1,this.textField.y=this.stage.stageHeight-this.textField.height>>1,egret.log(this.stage.stageWidth,this.textField.width),egret.log(this.textField.x,this.textField.y)},e.prototype.setProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var p2DebugDraw=function(){function t(t,e){this.COLOR_D_SLEEP=10066329,this.COLOR_D_WAKE=15053490,this.COLOR_K=8355813,this.COLOR_S=8381823,this.COLOR_BLACK=0,this.COLOR_RED=16711680,this.isDrawAABB=!1,this.factor=1,this.world=t,this.sprite=e}return t.prototype.drawDebug=function(){this.sprite.graphics.clear();for(var t=this.world.bodies.length,e=0;t>e;e++)for(var i=this.world.bodies[e],r=0;r<i.shapes.length;r++){var o=i.shapes[r];
this.drawShape(o,i),this.isDrawAABB&&this.drawAABB(i)}t=this.world.constraints.length;for(var n,r=0;t>r;r++)switch(n=this.world.constraints[r],n.type){case p2.Constraint.DISTANCE:this.drawDistanceJoint(n);break;case p2.Constraint.REVOLUTE:this.drawRevoluteJoint(n);break;case p2.Constraint.GEAR:this.drawGearJoint(n);break;case p2.Constraint.PRISMATIC:this.drawPrismaticJoint(n);break;case p2.Constraint.LOCK:this.drawLockJoint(n)}t=this.world.springs.length;for(var a,s=0;t>s;s++)a=this.world.springs[s],a instanceof p2.LinearSpring?this.drawLinearSpring(a):a instanceof p2.RotationalSpring&&this.drawRotationalSpring(a)},t.prototype.drawAABB=function(t){var e=new Array,i=t.aabb.lowerBound[0],r=t.aabb.lowerBound[1],o=t.aabb.upperBound[0],n=t.aabb.upperBound[1];isFinite(i)&&isFinite(r)&&isFinite(o)&&isFinite(n)&&(e.push([i,r],[o,r],[o,n],[i,n]),this.drawConvex(e,this.COLOR_S,1,!1))},t.prototype.drawDistanceJoint=function(t){var e,i=new Array,r=new Array;e=t.distance,t.upperLimitEnabled&&t.upperLimit>e&&(e=t.upperLimit),t.bodyA.toWorldFrame(i,t.localAnchorA),t.bodyB.toWorldFrame(r,t.localAnchorB);var o=p2.vec2.subtract([],r,i);p2.vec2.normalize(o,o),p2.vec2.scale(o,o,e);var n=p2.vec2.add([],i,o);this.drawSegment(i,t.bodyA.position,this.COLOR_S),this.drawSegment(r,t.bodyB.position,this.COLOR_S),this.drawVecAt(o,i,this.COLOR_BLACK),t.position>e&&this.drawSegment(r,n,this.COLOR_RED),this.drawCircle(i,3/this.factor,this.COLOR_BLACK),this.drawCircle(n,3/this.factor,this.COLOR_BLACK),t.lowerLimitEnabled&&(p2.vec2.normalize(o,o),p2.vec2.scale(o,o,t.lowerLimit),n=p2.vec2.add([],i,o),this.drawCircle(n,2/this.factor,this.COLOR_BLACK))},t.prototype.drawRevoluteJoint=function(t){var e=new Array,i=new Array;t.bodyA.toWorldFrame(e,t.pivotA),t.bodyB.toWorldFrame(i,t.pivotB),this.drawSegment(t.bodyA.position,e,this.COLOR_S),this.drawSegment(t.bodyB.position,i,this.COLOR_S),this.drawSegment(e,i,this.COLOR_RED),this.drawCircle(e,3/this.factor,this.COLOR_BLACK)},t.prototype.drawGearJoint=function(t){var e=t.bodyA.position,i=t.bodyB.position,r=new Array,o=new Array;t.bodyA.toWorldFrame(r,[20/this.factor,0]),t.bodyB.toWorldFrame(o,[20/this.factor,0]);var n=p2.vec2.subtract([],e,r),a=p2.vec2.subtract([],i,o);this.drawVecAt(n,e,this.COLOR_BLACK,!0),this.drawVecAt(a,i,this.COLOR_BLACK,!0),t.bodyB.toWorldFrame(a,[10*(t.bodyB.angle-t.bodyA.angle-t.angle)/this.factor,0]),this.drawSegment(a,i,this.COLOR_RED)},t.prototype.drawPrismaticJoint=function(t){var e=(t.bodyA.position,t.bodyB.position,new Array),i=new Array;t.bodyA.toWorldFrame(e,t.localAnchorA),t.bodyB.toWorldFrame(i,t.localAnchorB);var r=new Array;r=this.toWorldVector(t.localAxisA,t.bodyA);var o=p2.vec2.copy([],r),n=p2.vec2.copy([],r);t.lowerLimitEnabled?p2.vec2.scale(o,r,t.lowerLimit):p2.vec2.scale(o,r,5e3),t.upperLimitEnabled?p2.vec2.scale(n,r,t.upperLimit):p2.vec2.scale(n,r,5e3),this.drawVecAt(o,e,this.COLOR_BLACK,!0),this.drawVecAt(n,e,this.COLOR_BLACK,!0),p2.vec2.add(o,o,e),this.drawCircle(o,2/this.factor,this.COLOR_BLACK,1,!0),p2.vec2.add(n,n,e),this.drawCircle(n,2/this.factor,this.COLOR_BLACK,1,!0)},t.prototype.drawLockJoint=function(t){var e=new Array;new Array;t.bodyA.toWorldFrame(e,t.localOffsetB),this.drawSegment(e,t.bodyA.position,this.COLOR_S),this.drawSegment(e,t.bodyB.position,this.COLOR_RED),this.drawCircle(e,3/this.factor,this.COLOR_BLACK);var i=new Array;t.bodyA.toWorldFrame(i,[20/this.factor,0]),this.drawSegment(i,t.bodyA.position,this.COLOR_BLACK),t.bodyB.toWorldFrame(i,[20/this.factor,0]),this.drawSegment(i,t.bodyB.position,this.COLOR_BLACK)},t.prototype.drawLinearSpring=function(t){var e=new Array,i=new Array;t.bodyA.toWorldFrame(e,t.localAnchorA),t.bodyB.toWorldFrame(i,t.localAnchorB);var r=p2.vec2.subtract([],i,e);p2.vec2.normalize(r,r),p2.vec2.scale(r,r,t.restLength);var o=p2.vec2.add([],t.bodyA.position,r);this.drawSegment(o,t.bodyB.position,this.COLOR_RED),this.drawVecAt(r,e,this.COLOR_BLACK),this.drawCircle(e,3/this.factor,this.COLOR_RED),this.drawCircle(o,3/this.factor,this.COLOR_RED)},t.prototype.drawRotationalSpring=function(t){var e=new Array,i=new Array;e=t.bodyA.position,i=t.bodyB.position;var r=new Array,o=new Array;t.bodyA.toWorldFrame(r,[20/this.factor,0]),t.bodyB.toWorldFrame(o,[10*(t.bodyB.angle-t.bodyA.angle-t.restAngle+2)/this.factor,0]);var n=p2.vec2.subtract([],r,e),a=p2.vec2.subtract([],o,i);this.drawVecAt(n,e,this.COLOR_RED,!0),this.drawVecAt(a,i,this.COLOR_RED,!0),t.bodyB.toWorldFrame(o,[20/this.factor,0]),this.drawCircle(r,2/this.factor,this.COLOR_RED),this.drawCircle(o,2/this.factor,this.COLOR_RED)},t.prototype.drawShape=function(t,e,i,r){var i=void 0==i?this.getColor(e):i,r=void 0==r?!0:r;t instanceof p2.Convex?this.drawConvexShape(t,e,i,r):t instanceof p2.Plane?this.drawPlaneShape(t,e,i,r):t instanceof p2.Circle?this.drawCircleShape(t,e,i,r):t instanceof p2.Capsule?this.drawCapsule(t,e,i):t instanceof p2.Particle?this.drawParticle(t,e,i):t instanceof p2.Line?this.drawLine(t,e,i):t instanceof p2.Heightfield&&this.drawHeightfeild(t,e,i)},t.prototype.drawConvexShape=function(t,e,i,r){var o=(e.shapes.indexOf(t),t.position),n=t.angle,a=[],s=this.transformVec(t.vertices[0],o,n);e.toWorldFrame(a,o),e.toWorldFrame(s,s),this.drawSegment(a,s,i);for(var h=new Array,d=t.vertices.length,c=0;d>c;c++)s=this.transformVec(t.vertices[c],o,n),e.toWorldFrame(s,s),h.push(s);this.drawConvex(h,i,.5,r)},t.prototype.drawParticle=function(t,e,i){this.drawCircle(e.position,1/this.factor,i,.5),this.drawCircle(e.position,5/this.factor,i,1,!1)},t.prototype.drawLine=function(t,e,i){var r=t.length,o=new Array,n=new Array;e.toWorldFrame(o,[-r/2,0]),e.toWorldFrame(n,[r/2,0]),this.drawSegment(o,n,i)},t.prototype.drawHeightfeild=function(t,e,i){var r=this.sprite.graphics;r.lineStyle(1,i),r.beginFill(i,.5);var o,n=t.heights,a=t.elementWidth,s=new Array,h=new Array;n.forEach(function(t,i){o=i*a,s=new Array,e.toWorldFrame(s,[o,t]),h.push(s)}),s=new Array,e.toWorldFrame(s,[o,-500]),h.push(s),s=new Array,e.toWorldFrame(s,[0,-500]),h.push(s),s=new Array,e.toWorldFrame(s,[0,0]),h.push(s),this.drawConvex(h,i,.5)},t.prototype.drawCapsule=function(t,e,i){var r=t.length,o=t.radius,n=new Array,a=new Array,s=new Array,h=new Array,d=new Array,c=new Array;e.toWorldFrame(n,[-r/2,-o]),e.toWorldFrame(a,[r/2,-o]),e.toWorldFrame(s,[r/2,o]),e.toWorldFrame(h,[-r/2,o]),e.toWorldFrame(d,[r/2,0]),e.toWorldFrame(c,[-r/2,0]),this.drawCircle(d,o,i,.5),this.drawCircle(c,o,i,.5),this.drawConvex([n,a,s,h],i,.5)},t.prototype.drawCircleShape=function(t,e,i,r){var o=t.position,n=t.angle,a=new Array;e.toWorldFrame(a,o),this.drawCircle(a,t.radius,i,.5,r);var s=this.transformVec([t.radius,0],o,n);e.toWorldFrame(s,s),this.drawSegment(a,s,i)},t.prototype.drawPlaneShape=function(t,e,i,r){var o=new Array,n=new Array;e.shapes.indexOf(t);e.toWorldFrame(o,[1e3,0]),o=this.transformVec(o,t.position,t.angle),n.push(o),o=new Array,e.toWorldFrame(o,[1e3,-1e5]),o=this.transformVec(o,t.position,t.angle),n.push(o),o=new Array,e.toWorldFrame(o,[-1e3,-1e5]),o=this.transformVec(o,t.position,t.angle),n.push(o),o=new Array,e.toWorldFrame(o,[-1e3,0]),o=this.transformVec(o,t.position,t.angle),n.push(o),this.drawConvex(n,i,.5,r)},t.prototype.getColor=function(t){var e=this.COLOR_D_SLEEP;return t.type==p2.Body.KINEMATIC?e=this.COLOR_K:t.type==p2.Body.STATIC?e=this.COLOR_S:t.sleepState==p2.Body.AWAKE&&(e=this.COLOR_D_WAKE),e},t.prototype.drawVecAt=function(t,e,i,r){void 0===r&&(r=!1);var o=p2.vec2.copy([],e),n=p2.vec2.add([],t,e);r&&this.drawCircle(o,3/this.factor,i),this.drawSegment(o,n,i)},t.prototype.drawVecTo=function(t,e,i,r){void 0===r&&(r=!1);var o=p2.vec2.copy([],e),n=p2.vec2.subtract([],e,t);r&&this.drawCircle(o,3/this.factor,i),this.drawSegment(o,n,i)},t.prototype.drawSegment=function(t,e,i){this.sprite.graphics.lineStyle(1,i),this.sprite.graphics.moveTo(t[0]*this.factor,t[1]*this.factor),this.sprite.graphics.lineTo(e[0]*this.factor,e[1]*this.factor)},t.prototype.drawCircle=function(t,e,i,r,o){void 0===r&&(r=1),this.sprite.graphics.lineStyle(1,i),(o||void 0==o)&&this.sprite.graphics.beginFill(i,r),this.sprite.graphics.drawCircle(t[0]*this.factor,t[1]*this.factor,e*this.factor),this.sprite.graphics.endFill()},t.prototype.drawConvex=function(t,e,i,r){void 0===i&&(i=1),void 0===r&&(r=!0),this.sprite.graphics.lineStyle(1,e),r&&this.sprite.graphics.beginFill(e,i);var o=t.length,n=t[0];this.sprite.graphics.moveTo(n[0]*this.factor,n[1]*this.factor);for(var a=1;o>=a;a++)n=t[a%o],this.sprite.graphics.lineTo(n[0]*this.factor,n[1]*this.factor);this.sprite.graphics.endFill()},t.prototype.toWorldVector=function(t,e){var i=new Array;return p2.vec2.rotate(i,t,e.angle),i},t.prototype.transformVec=function(t,e,i){var r=new Array;return p2.vec2.rotate(r,t,i),p2.vec2.add(r,r,e),r},t.prototype.drawDotLine=function(t,e,i,r){if(void 0===e&&(e=0),void 0===i&&(i=!1),void 0===r&&(r=30),!(t.length<2)){var o=2/this.factor,n=[];p2.vec2.copy(n,t[0]),this.drawCircle(n,o,e,1,!1);for(var a=0;a<t.length-2;a++){var s=t[a];if(i)for(var h=p2.vec2.distance(n,s);h>r/this.factor;){var d=[];p2.vec2.subtract(d,s,n),p2.vec2.scale(d,d,r/this.factor/h),p2.vec2.add(n,n,d),this.drawCircle(n,o,e,1,!1),h=p2.vec2.distance(n,s)}else this.drawCircle(s,o,e,1,!1)}}},t}();__reflect(p2DebugDraw.prototype,"p2DebugDraw");var P2Drag=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAppReady=function(){this.enableMouseDrag(new p2.World({gravity:[0,100]})),this.createFourWall(),this.createDebug(),this.createBody()},e.prototype.createBody=function(){var t=20*Math.random()+30,e=new p2.Circle({radius:t}),i=new p2.Body({mass:10});i.addShape(e),i.position=[200*Math.random()+50,200*Math.random()+50],i.angle=Math.PI;var r=new egret.Sprite;r.graphics.beginFill(16776960),r.graphics.drawCircle(0,0,t),r.graphics.endFill(),r.alpha=.1,this.addChild(r),i.userData={skin:r},this.world.addBody(i)},e.prototype.loop=function(){t.prototype.loop.call(this);for(var e=this.world.bodies,i=e.length,r=0;i>r;r++){var o=e[r];if(o.userData&&o.userData.skin){var n=o.userData.skin;n.x=o.position[0],n.y=o.position[1],n.rotation=180*o.angle/Math.PI}}},e}(AbstractP2Test);__reflect(P2Drag.prototype,"P2Drag");var TestFromPolygon=function(t){function e(){var e=t.call(this)||this;return e.points=new Array,e}return __extends(e,t),e.prototype.onAppReady=function(){this.createWorld(),this.createFourWall(),this.createDebug(),this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touchEventHandler,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.touchEventHandler,this),this.createBody()},e.prototype.createWorld=function(){var t=new p2.World;t.sleepMode=p2.World.BODY_SLEEPING,t.gravity=[0,100],this.world=t},e.prototype.createFourWall=function(){function t(t){var e=new p2.Box({width:t.width,height:t.height}),i=new p2.Body({mass:0});i.addShape(e),i.position=[t.x,t.y],a.addBody(i)}var e=10,i=this.stage.stageWidth,r=this.stage.stageHeight,o=i/2,n=r/2,a=this.world;t(new egret.Rectangle(o,0,i,e)),t(new egret.Rectangle(o,r,i,e)),t(new egret.Rectangle(0,n,e,r)),t(new egret.Rectangle(i,n,e,r))},e.prototype.createGround=function(){var t=new p2.Box({width:this.stage.stageWidth,height:10}),e=new p2.Body;e.addShape(t),e.type=p2.Body.STATIC,e.position=[this.stage.stageWidth/2,this.stage.stageHeight],e.angle=Math.PI,this.world.addBody(e)},e.prototype.createBody=function(){var t=new p2.Circle({radius:20*Math.random()+30}),e=new p2.Body({mass:10});e.addShape(t),e.position=[200*Math.random(),200*Math.random()],e.angle=Math.PI,this.world.addBody(e)},e.prototype.loop=function(){this.world.step(1/60),this.debugDraw.drawDebug(),this.points.length>1&&this.debugDraw.drawConvex(this.points,0,1,!1)},e.prototype.touchEventHandler=function(t){var e=new Array(t.stageX/this.factor,t.stageY/this.factor);switch(t.type){case egret.TouchEvent.TOUCH_BEGIN:this.prePoint=this.copyPoint(e),this.points.push(this.prePoint,this.prePoint),this.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchEventHandler,this);break;case egret.TouchEvent.TOUCH_END:this.createConvexBody(),this.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchEventHandler,this);break;case egret.TouchEvent.TOUCH_MOVE:var i=p2.vec2.dist(e,this.prePoint);i>30/this.factor?(this.points.push(this.prePoint),this.prePoint=this.copyPoint(e),this.points[this.points.length-1]=this.copyPoint(e)):this.points[this.points.length-1]=this.copyPoint(e)}},e.prototype.createConvexBody=function(){var t=new p2.Body({mass:10});t.fromPolygon(this.points,{optimalDecomp:!1}),this.world.addBody(t),this.points=[]},e.prototype.copyPoint=function(t){return new Array(t[0],t[1])},e}(AbstractP2Test);__reflect(TestFromPolygon.prototype,"TestFromPolygon");var CreateView=function(t){function e(){var e=t.call(this)||this,i=new egret.Shape;i.graphics.beginFill(16711680),i.graphics.drawCircle(0,0,200),i.graphics.endFill(),e.addChild(i);var r=new egret.TextField;e.addChild(r),r.text="646136549879";var o=new eui.Image;o.source="bg_jpg",e.addChild(o);var n=new eui.Button;return n.label="Test",n.width=200,n.height=150,e.addChild(n),n.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){},e),e.addChild(new TestView),e}return __extends(e,t),e.prototype.init=function(){},e}(egret.Sprite);__reflect(CreateView.prototype,"CreateView");var ReadJson=function(){function t(){this.init()}return t.prototype.init=function(){var t=RES.getRes("RoleIcon_json");for(var e in t){var i=t[e];for(var r in i)egret.log(r,"=",i[r])}},t}();__reflect(ReadJson.prototype,"ReadJson");var TestView=function(t){function e(){var e=t.call(this)||this;return e.skinName="TestUI",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e}(eui.Component);__reflect(TestView.prototype,"TestView");var Main=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isThemeLoadEnd=!1,e.isResourceLoadEnd=!1,e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(t){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var e=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",e),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},e.prototype.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this);var e=new eui.Theme("resource/default.thm.json",this.stage);e.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},e.prototype.onThemeLoadComplete=function(){this.isThemeLoadEnd=!0,this.createScene()},e.prototype.onResourceLoadComplete=function(t){"preload"==t.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.isResourceLoadEnd=!0,this.createScene())},e.prototype.createScene=function(){this.isThemeLoadEnd&&this.isResourceLoadEnd&&this.startCreateScene()},e.prototype.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},e.prototype.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},e.prototype.onResourceProgress=function(t){"preload"==t.groupName&&this.loadingView.setProgress(t.itemsLoaded,t.itemsTotal)},e.prototype.startCreateScene=function(){this.addChild(new MainTest)},e}(eui.UILayer);__reflect(Main.prototype,"Main");var draw;!function(t){var e=function(){function t(){}return Object.defineProperty(t,"randomColor",{get:function(){return 16777215*Math.random()},enumerable:!0,configurable:!0}),t.getRect=function(t,e,i,r,o){void 0===i&&(i=0),void 0===r&&(r=0),void 0===o&&(o=0);var n=new egret.Sprite;return n.graphics.beginFill(i),n.graphics.drawRect(r,o,t,e),n.graphics.endFill(),n},t.getRectAndX=function(t,e,i,r,o){void 0===i&&(i=0),void 0===r&&(r=0),void 0===o&&(o=0);var n=this.getRect(t,e,i,r,o),a=new egret.Sprite;a.graphics.lineStyle(.1),a.graphics.moveTo(0,0),a.graphics.lineTo(t,e);var s=new egret.Sprite;return s.graphics.lineStyle(.1),s.graphics.moveTo(t,0),s.graphics.lineTo(0,e),n.addChild(a),n.addChild(s),n},t.getRoundRect=function(t,e,i,r,o,n,a){void 0===i&&(i=0),void 0===r&&(r=5),void 0===o&&(o=5),void 0===n&&(n=0),void 0===a&&(a=0);var s=new egret.Sprite;return s.graphics.beginFill(i),s.graphics.drawRoundRect(n,a,t,e,r,o),s.graphics.endFill(),s},t.getCircle=function(t,e,i,r){void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0);var o=new egret.Sprite;return o.graphics.beginFill(e),o.graphics.drawCircle(i,r,t),o.graphics.endFill(),o},t.getPolygon=function(t,e,i,r){void 0===t&&(t=3),void 0===e&&(e=10),void 0===i&&(i=0),void 0===r&&(r=0);var o=new egret.Sprite;o.rotation=r,o.graphics.beginFill(i);for(var n=0;t>=n;n++){var a=Math.cos(n*(360/t)*Math.PI/180)*e,s=Math.sin(n*(360/t)*Math.PI/180)*e;0==n?o.graphics.moveTo(a,s):o.graphics.lineTo(a,s)}return o.graphics.endFill(),o},t.getArrowRoundRect=function(t,e,i,r,o){void 0===r&&(r=0),void 0===o&&(o=0);var n=new egret.Sprite;n.addChild(this.getRoundRect(t,e,i));var a=this.getPolygon(3,t/3,r,30+o);return a.x=n.width>>1,a.y=n.height>>1,n.addChild(a),n},t.getScrollLineBar=function(t,e,i){for(var r=new egret.Sprite,o=e/3,n=0;3>n;n++){var a=this.getRect(t,1,i,0,n*o);r.addChild(a)}return r},t.getAddRoundRect=function(t,e,i){var r=new egret.Sprite;r.addChild(this.getRoundRect(t,e,i));var o=this.getRect(t/2,2,0,t/4,e/2-1),n=this.getRect(2,e/2,0,t/2-1,e/4);return r.addChild(o),r.addChild(n),r},t.getRemoveRoundRect=function(t,e,i){var r=new egret.Sprite;r.addChild(this.getRoundRect(t,e,i));var o=this.getRect(t/2,2,0,t/4,e/2-1);return r.addChild(o),r},t.getRoundRectText=function(t,e,i,r){void 0===r&&(r="click");var o=new egret.Sprite;o.addChild(this.getRoundRect(t,e,i));var n=new egret.TextField;return n.text=r,n.x=o.width-n.width>>1,n.y=o.height-n.height>>1,o.addChild(n),o},t.getCheckBoxRect=function(t,e,i){void 0===t&&(t=16777215),void 0===e&&(e=0),void 0===i&&(i=0);var r=new egret.Sprite;if(r.addChild(this.getRect(20,20,t)),1==i){var o=new egret.Sprite;o.graphics.beginFill(e),o.graphics.moveTo(0,10),o.graphics.lineTo(10,18),o.graphics.lineTo(22,4),o.graphics.lineTo(18,0),o.graphics.lineTo(10,9),o.graphics.lineTo(6,4),o.graphics.lineTo(0,10),r.addChild(o)}return r},t.getRadioCircle=function(t,e,i){void 0===t&&(t=16777215),void 0===e&&(e=0),void 0===i&&(i=0);var r=new egret.Sprite;if(r.addChild(this.getCircle(9,t,9,9)),1==i){var o=this.getCircle(5,e,9,9);r.addChild(o)}return r},t.getGridding=function(t,e){void 0===e&&(e=0);var i=new egret.Sprite;i.graphics.lineStyle(.1,e);for(var r=t.width/t.x,o=t.height/t.y,n=0;n<t.x;n++)i.graphics.moveTo(0,n*o),i.graphics.lineTo(t.width,n*o);for(n=0;n<t.y;n++)i.graphics.moveTo(n*r,0),i.graphics.lineTo(n*r,t.height);return i},t}();t.BasicUI=e,__reflect(e.prototype,"draw.BasicUI")}(draw||(draw={}));var control;!function(t){var e=function(){function t(t,e,i){void 0===i&&(i=null),this.vx=0,this.vy=0,this.prevX=0,this.prevY=0,this.leftTop=.25,this.rightBottom=.75,this.layers=new Array,this.anchorPoint=new egret.Point(1,1),this.target=t,this.screen=e,this.cameraRect=i,this.setBoundary(this.leftTop,this.rightBottom),this.screenWidth=e.width,this.screenHeight=e.height}return t.prototype.setBoundary=function(t,e){this.leftTop=t,this.rightBottom=e,this.leftBoundary=this.cameraRect.width*this.leftTop,this.topBoundary=this.cameraRect.height*this.leftTop,this.rightBoundary=this.cameraRect.width*this.rightBottom,this.bottomBoundary=this.cameraRect.height*this.rightBottom},t.prototype.setScreen=function(t){this.screen=t,this.screenWidth=t.width,this.screenHeight=t.height},t.prototype.setTarget=function(t){this.target=t,this.prevX=this.target.x,this.prevY=this.target.y},t.prototype.setTargetAnchor=function(t){this.anchorPoint=t},t.prototype.addLayer=function(t){this.layers.push(t)},t.prototype.drawBoundary=function(t){void 0===t&&(t=16711680);var e=new egret.Sprite;return e.graphics.lineStyle(1,t),e.graphics.beginFill(0,0),e.graphics.drawRect(this.leftBoundary,this.topBoundary,this.rightBoundary-this.leftBoundary,this.bottomBoundary-this.topBoundary),e},t.prototype.move=function(){if(this.vx=this.target.x-this.prevX,this.vy=this.target.y-this.prevY,this.prevX=this.target.x,this.prevY=this.target.y,0!=this.vx||0!=this.vy){var t=this.target.parent.localToGlobal(this.target.x,this.target.y),e=this.target.width*this.anchorPoint.x,i=this.target.height*this.anchorPoint.y;this.vx>0?(t.x+e>this.rightBoundary&&(this.screen.x-=this.vx),this.screen.x<this.cameraRect.width-this.screenWidth&&(this.screen.x=this.cameraRect.width-this.screenWidth)):this.vx<0&&(t.x<this.leftBoundary&&(this.screen.x-=this.vx),this.screen.x>this.cameraRect.x&&(this.screen.x=this.cameraRect.x)),this.vy>0?(t.y+i>this.bottomBoundary&&(this.screen.y-=this.vy),this.screen.y<this.cameraRect.height-this.screenHeight&&(this.screen.y=this.cameraRect.height-this.screenHeight)):this.vy<0&&(t.y<this.topBoundary&&(this.screen.y-=this.vy),this.screen.y>this.cameraRect.y&&(this.screen.y=this.cameraRect.y)),this.moveLayer()}},t.prototype.moveLayer=function(){for(var t=this.layers.length,e=0;t>e;e++){var i=this.layers[e];i.x=this.screen.x*((i.width-this.cameraRect.width)/(this.screen.width-this.cameraRect.width)),i.y=this.screen.y*((i.height-this.cameraRect.height)/(this.screen.height-this.cameraRect.height))}},t}();t.Camera2D=e,__reflect(e.prototype,"control.Camera2D")}(control||(control={}));var LayoutManager=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.displayRank=function(t,e,i,r,o,n,a){void 0===e&&(e=1),void 0===i&&(i=0),void 0===r&&(r=0),void 0===o&&(o=0),void 0===n&&(n=0),void 0===a&&(a=1);for(var s,h=0;h<t.length;h++)s=t[h],s.x=o+Math.floor(h%e)*(s.width+i)*a,s.y=n+Math.floor(h/e)*(s.height+r)*a},e.displayRankPart=function(t,i,r,o){void 0===r&&(r=null),void 0===o&&(o=1);var n,a,s,h,d,c,l;n=i[0],s=i[1],h=i[2],d=i[3],c=i[4],l=i[5];var p=t.slice(0,n);if(e.displayRank(p,s,h,d,c,l,o),r){a=r[0],s=r[1],h=r[2],d=r[3],c=r[4],l=r[5];var g=t.slice(n,n+a);e.displayRank(g,s,h,d,c,l,o)}},e.displayCircle=function(t,e,i,r,o,n,a,s,h,d){void 0===o&&(o=2*Math.PI),void 0===n&&(n=0),void 0===a&&(a=0),void 0===s&&(s=0),void 0===h&&(h=0),void 0===d&&(d=0);var c,l=t.length,p=o/l;o<2*Math.PI&&(p=o/(l-1));for(var g=0;l>g;g++)c=t[g],c.x=e+Math.cos(p*g-n)*(r+h)+a,c.y=i+Math.sin(p*g-n)*(r+d)+s},e.displayPolygon=function(t,e,i,r,o,n){if(void 0===r&&(r=100),void 0===o&&(o=5),void 0===n&&(n=0),3>o||o>t.length)return void console.log("多边形的边数不正确");for(var a,s=t.length,h=2*Math.PI/o,d=Math.floor(s/o),c=0;o>c;c++){var l=e+Math.cos(c*h-n)*r,p=i+Math.sin(c*h-n)*r,g=c+1;g=g==o?0:g;for(var u=e+Math.cos(g*h-n)*r,v=i+Math.sin(g*h-n)*r,y=0;d>y;y++){var f=y+d*c;s>f&&(a=t[f],a.x=l,a.y=p,a.x+=(u-l)/d*y,a.y+=(v-p)/d*y)}}},e.displayTrigon=function(t,e,i,r,o,n,a){function s(){var g=0,u=p.length;u>1&&a&&(g=(u-1)*(h.width+e)/-2*n);for(var v=0;u>v;v++)h=p[v],h.x=r+v*(h.width+e)*n+g,h.y=o+(l-1)*(h.height+i)*n;l++,d=c,c=d+l,p=t.slice(d,c),c<=t.length+d&&s()}void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===o&&(o=0),void 0===n&&(n=1),void 0===a&&(a=!0);var h,d=0,c=1,l=1,p=t.slice(d,c);s()},e.displayWall=function(t,e,i,r,o,n,a){void 0===e&&(e=1),void 0===i&&(i=0),void 0===r&&(r=0),void 0===o&&(o=0),void 0===n&&(n=0),void 0===a&&(a=10);for(var s,h=0;h<t.length;h++){var d=Math.floor(h/e)%2==0?a:0;s=t[h],s.x=o+Math.floor(h%e)*(s.width+i)+d,s.y=n+Math.floor(h/e)*(s.height+r)}},e.displayRankX=function(t,e,i,r,o){void 0===e&&(e=1),void 0===i&&(i=0),void 0===r&&(r=0),void 0===o&&(o=0);for(var n,a=t.length,s=0,h=0;a>h;h++){n=t[h];n.width;n.y=o,n.x=s,s=n.x+(n.width+i)}},e}(egret.HashObject);__reflect(LayoutManager.prototype,"LayoutManager");var P2World=function(t){function e(e,i){void 0===e&&(e=0),void 0===i&&(i=0);var r=t.call(this)||this;return r.colors=[10],r.removeBodys=[],r.world=new p2.World({gravity:[e,i]}),r.colors[p2.Body.DYNAMIC]=16711680,r.colors[p2.Body.KINEMATIC]=65280,r.colors[p2.Body.STATIC]=255,r.addEventListener(egret.Event.ENTER_FRAME,r.updateWorld,r),r.txtWarn=new egret.TextField,r}return __extends(e,t),Object.defineProperty(e.prototype,"p2World",{get:function(){return this.world},enumerable:!0,configurable:!0}),e.prototype.getBody=function(t,e){void 0===t&&(t=0),void 0===e&&(e=p2.Body.DYNAMIC);var i=new p2.Body({mass:t});return i.type=e,i.userData={},i},e.prototype.createWall=function(t){this.createPlane(0,0,0),this.createPlane(-Math.PI/2,0,0),this.createPlane(Math.PI,0,t.height),this.createPlane(Math.PI/2,t.width,0)},e.prototype.createPlane=function(t,e,i){void 0===t&&(t=Math.PI);var r=new p2.Plane,o=this.getBody(0,p2.Body.STATIC);return o.addShape(r),o.angle=t,o.position[0]=e,o.position[1]=i,this.world.addBody(o),o},e.prototype.createCircleBodyShape=function(t,e){void 0===e&&(e=p2.Body.DYNAMIC);var i=this.getBody(10,e),r=new p2.Circle({radius:t});return i.addShape(r),this.world.addBody(i),i},e.prototype.createBoxBodyShape=function(t,e,i,r){void 0===i&&(i=p2.Body.DYNAMIC),void 0===r&&(r=0);var o=this.getBody(10,i),n=new p2.Box({width:t,height:e});return o.addShape(n),o.angle=r,this.world.addBody(o),o},e.prototype.createConvexBodyShape=function(t,e){void 0===e&&(e=p2.Body.DYNAMIC);var i=this.getBody(10,e);return i.fromPolygon(t,{optimalDecomp:!1}),this.world.addBody(i),i},e.prototype.createPolygon=function(t,e,i){void 0===t&&(t=3),void 0===e&&(e=30),void 0===i&&(i=p2.Body.DYNAMIC);for(var r=(this.getBody(10,i),[]),o=0;t>o;o++){var n=Math.cos(o*(360/t)*Math.PI/180)*e,a=Math.sin(o*(360/t)*Math.PI/180)*e;r.push([n,a])}return this.createConvexBodyShape(r,i)},e.prototype.createBoxCircleBodyShape=function(t,e,i){void 0===i&&(i=p2.Body.DYNAMIC);var r=this.getBody(10,i);r.fixedRotation=!0,t/=2,e/=1.5;var o=new p2.Box({width:t,height:e}),n=new p2.Circle({radius:t/2});return r.addShape(o),r.addShape(n),o.position[1]=-e,n.position[1]=-t/2,this.world.addBody(r),r},e.prototype.drawSkin=function(t){var e=new egret.Sprite,i=this.colors[t.type];e.graphics.lineStyle(1,i,1),e.graphics.beginFill(i,.5);for(var r=0;r<t.shapes.length;r++){var o=t.shapes[r],n=new egret.Point(o.position[0],o.position[1]);if(o instanceof p2.Box){var a=o.width,s=o.height,h=a/2,d=s/2;e.graphics.moveTo(n.x,n.y),e.graphics.lineTo(n.x-h,n.y-d),e.graphics.drawRect(n.x-h,n.y-d,a,s),e.graphics.endFill()}else if(o instanceof p2.Convex){var c=o.vertices,l=c.length,p=c[0];e.graphics.moveTo(0,0),e.graphics.lineTo(p[0],p[1]);for(var g=0;l>g;g++)p=c[g],0==g?e.graphics.moveTo(p[0],p[1]):e.graphics.lineTo(p[0],p[1]);var p=c[0];e.graphics.lineTo(p[0],p[1]),e.graphics.endFill()}else if(o instanceof p2.Circle){var u=o.radius;e.graphics.moveTo(n.x,n.y),e.graphics.lineTo(n.x,u+n.y),e.graphics.drawCircle(n.x,n.y,u),e.graphics.endFill()}}return e.x=t.position[0],e.y=t.position[1],t.userData.skin=e,this.addChild(e),e},e.prototype.updateWorld=function(t){var e=1/60,i=this.removeBodys;this.world.step(e);for(var r=this.world.bodies,o=r.length,n=0;o>n;n++){var a=r[n];if(a.userData&&a.userData.skin){var s=a.userData.skin;s.x=a.position[0],s.y=a.position[1],s.rotation=180*a.angle/Math.PI}else a.shapes[0]instanceof p2.Plane||(this.txtWarn.x=this.txtWarn.y=200,this.addChild(this.txtWarn),this.txtWarn.text="警告：有刚体没有设置皮肤")}for(n=0;n<i.length;n++)a=i[n],a.userData&&a.userData.skin&&(s=a.userData.skin,null!=s.parent&&s.parent.removeChild(s),a.userData=null),this.world.removeBody(a);null!=this.loopBackFun&&this.loopBackFun()},e}(egret.DisplayObjectContainer);__reflect(P2World.prototype,"P2World");var SoundControl=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.sounds={},e.channels={},e.volumeBg=1,e.volumeEffect=1,e.isNoVolume=1,e}return __extends(e,t),e.getIns=function(){return null==this.instance&&(this.instance=new e),this.instance},e.prototype.checkSoundIsBg=function(t,e){return t[e+"-bg"]},e.prototype.addItem=function(t,e){void 0===e&&(e=!1);var i=t;if(e&&(i=t+"-bg"),!this.sounds[i]){var r=RES.getRes(t);this.sounds[i]=r}},e.prototype.play=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=1);var r=this.volumeEffect;if(this.checkSoundIsBg(this.sounds,t)&&(t+="-bg",r=this.volumeBg),this.sounds[t]){var o=this.sounds[t];this.channels[t]=o.play(e,i),0==this.isNoVolume?this.channels[t].volume=0:this.channels[t].volume=r}},e.prototype.stop=function(t){if(this.checkSoundIsBg(this.channels,t)&&(t+="-bg"),this.channels[t]){var e=this.channels[t];e.stop()}},e.prototype.setVolume=function(t,e){if(this.checkSoundIsBg(this.channels,t)&&(t+="-bg"),this.channels[t]){var i=this.channels[t];i.volume=e}},e.prototype.setBgVolume=function(t){for(var e in this.channels)if(2==e.split("-bg").length){var i=this.channels[e];this.volumeBg=t,0!=i.position&&(i.volume=t)}},e.prototype.setEffectVolume=function(t){for(var e in this.channels)if(1==e.split("-bg").length){var i=this.channels[e];this.volumeEffect=t,0!=i.position&&(i.volume=t)}},e.prototype.setIsNoVolume=function(t){this.isNoVolume=t;for(var e in this.channels){var i=this.channels[e];0!=i.position&&(0==t?i.volume=0:this.checkSoundIsBg(this.sounds,e)?i.volume=this.volumeBg:i.volume=this.volumeEffect)}},e}(egret.HashObject);__reflect(SoundControl.prototype,"SoundControl");